<!doctype html>
<html lang="de">
<head>
Â  <meta charset="utf-8"/>
Â  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
Â  <title>ARea Viewer â€“ Surface AR</title>

Â  Â  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

Â  <style>
Â  Â  :root{
Â  Â  Â  color-scheme:dark light;
Â  Â  Â  /* NEU: Variable fÃ¼r den vertikalen Offset, wird im JS gesetzt */
Â  Â  Â  --model-vertical-offset: 0;
Â  Â  }
Â  Â  *,*::before,*::after{box-sizing:border-box}
Â  Â  html,body{
Â  Â  Â  margin:0;height:100%;
Â  Â  Â  background:#000 !important;
Â  Â  Â  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
Â  Â  Â  overscroll-behavior:none;touch-action:manipulation;
Â  Â  }

Â  Â  /* Poster */
Â  Â  #poster{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#05070c;z-index:9999;color:#fff;text-align:center;padding:24px}
Â  Â  #poster-inner{max-width:420px;width:100%;padding:24px 20px;border-radius:24px;background:radial-gradient(circle at top,#243b74,#05070c);box-shadow:0 18px 40px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,.08)}
Â  Â  #posterImage{width:100%;max-height:220px;object-fit:cover;border-radius:16px;display:none;margin-bottom:16px;background:#111}
Â  Â  #poster h1{font-size:22px;margin:0 0 8px}
Â  Â  #poster p{margin:0 0 16px;font-size:14px;opacity:0.9}
Â  Â  #startAr{appearance:none;border:none;border-radius:999px;padding:10px 22px;font-size:15px;font-weight:500;background:linear-gradient(135deg,#5ddcff,#3c67e3);color:#fff;cursor:pointer;box-shadow:0 8px 22px rgba(0,0,0,.5)}
Â  Â  #startAr[disabled]{opacity:.55;cursor:wait}

Â  Â  /* model-viewer Host */
Â  Â  model-viewer{
Â  Â  Â  position:fixed;inset:0;width:100vw;height:100svh;display:block;
Â  Â  Â  background:#000 !important;z-index:1;
Â  Â  Â  /* NEU: Anwenden der vertikalen Verschiebung fÃ¼r Anti-Schwebe-Fix */
Â  Â  Â  transform: translateY(var(--model-vertical-offset));Â 
Â  Â  }

Â  Â  /* Fehler */
Â  Â  #err{position:fixed;left:12px;top:12px;z-index:10000;background:#b00020;color:#fff;padding:8px 10px;border-radius:8px;display:none;font:12px/1.35 monospace;max-width:min(92vw,680px);white-space:pre-wrap}

Â  Â  /* AR UI â€“ Kamera-Toolbar (nur WebXR) */
Â  Â  #ar-ui{
Â  Â  Â  position:fixed;inset:0;z-index:9000;display:none;pointer-events:none;font-family:inherit;
Â  Â  }
Â  Â  .bottom-bar{
Â  Â  Â  position:absolute;left:0;right:0;bottom:max(env(safe-area-inset-bottom),16px);
Â  Â  Â  display:flex;align-items:center;justify-content:center;gap:22px;pointer-events:auto;padding:0 18px;
Â  Â  }
Â  Â  /* Buttons */
Â  Â  #btn-gallery{width:54px;height:54px;border-radius:14px;overflow:hidden;border:1px solid rgba(255,255,255,.25);background:#0b0f16 center/cover no-repeat;box-shadow:0 6px 16px rgba(0,0,0,.6)}
Â  Â  #btn-gallery img{width:100%;height:100%;object-fit:cover;display:block}
Â  Â  #btn-gallery:empty::after{content:"";display:block;width:100%;height:100%;background:linear-gradient(135deg,#2a3a52,#253044)}
Â  Â Â 
Â  Â  #btn-shutter{appearance:none;border:none;cursor:pointer;width:78px;height:78px;border-radius:50%;background:radial-gradient(circle at 50% 50%,#fff 60%,#dfe6f2 100%);box-shadow:0 8px 22px rgba(0,0,0,.55)}
Â  Â  #btn-shutter.recording{background:radial-gradient(circle at 50% 50%,#ff3b30 60%,#d7261b 100%);animation:pulse 1.1s ease-in-out infinite}
Â  Â  #btn-shutter.snap{animation:snap-blink 180ms ease-out}
Â  Â Â 
Â  Â  /* Mute Button Style */
Â  Â  #btn-mute{
Â  Â  Â  appearance:none;border:none;cursor:pointer;width:44px;height:44px;border-radius:50%;
Â  Â  Â  background:rgba(30,30,30,0.6);color:#fff;font-size:18px;
Â  Â  Â  display:flex;align-items:center;justify-content:center;
Â  Â  Â  backdrop-filter:blur(4px);border:1px solid rgba(255,255,255,0.2);
Â  Â  Â  box-shadow:0 4px 12px rgba(0,0,0,0.4);
Â  Â  }

Â  Â  @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}
Â  Â  @keyframes snap-blink{0%{transform:scale(1)}50%{transform:scale(.9)}100%{transform:scale(1)}}
Â  Â  #rec-info{position:absolute;bottom:calc(max(env(safe-area-inset-bottom),16px)+96px);left:50%;transform:translateX(-50%);
Â  Â  Â  background:#ff3b30;color:#fff;padding:4px 8px;border-radius:4px;font-size:14px;
Â  Â  Â  display:none;align-items:center;gap:4px;
Â  Â  }
Â  Â  #rec-info::before{content:"â—";font-size:10px;animation:pulse 1s infinite}
Â  </style>

</head>
<body>

Â  Â  <model-viewer id="modelViewer"Â 
Â  Â  loading="eager"Â 
Â  Â  poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"Â 
Â  Â  disable-tap>
Â  </model-viewer>

Â  Â  <div id="poster">
Â  Â  <div id="poster-inner">
Â  Â  Â  <img id="posterImage" src="" alt="Vorschaubild">
Â  Â  Â  <h1 id="posterTitle">3D / AR Erlebnis</h1>
Â  Â  Â  <p id="posterText">Tippe auf Start AR, um das Modell in deiner Umgebung zu sehen.</p>
Â  Â  Â  <button id="startAr">START AR</button>
Â  Â  </div>
Â  </div>

Â  Â  <div id="ar-ui">
Â  Â  <div class="bottom-bar">
Â  Â  Â  <button id="btn-mute">ğŸ”Š</button>Â  Â  Â  Â  <div id="btn-gallery"></div>
Â  Â  Â  <button id="btn-shutter"></button>
Â  Â  Â  <div id="rec-info">00:00</div>
Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="err"></div>

Â  Â  <script type="module">

// HINWEIS: Der Import von 'publish-utils.js' wurde entfernt.
// Die benÃ¶tigte Hilfsfunktion fetchWithTimeout ist jetzt hier integriert.

// --- INEGRIERTE HILFSFUNKTION (ersetzt publish-utils.js) ---
/**
 * FÃ¼hrt einen Fetch-Request mit Timeout durch.
 */
async function fetchWithTimeout(resource, options = {}) {
Â  Â  // Korrekte Verwendung von timeoutMs aus options, wie von Copilot gefordert
Â  Â  const { timeoutMs = 15000 } = options; 
Â  Â  const controller = new AbortController();
Â  Â  const id = setTimeout(() => controller.abort(), timeoutMs);

Â  Â  try {
Â  Â  Â  Â  const response = await fetch(resource, {
Â  Â  Â  Â  Â  Â  ...options,
Â  Â  Â  Â  Â  Â  signal: controller.signal
Â  Â  Â  Â  });
Â  Â  Â  Â  clearTimeout(id);
Â  Â  Â  Â  return response;
Â  Â  } catch (error) {
Â  Â  Â  Â  clearTimeout(id);
Â  Â  Â  Â  throw error;
Â  Â  }
}
// -----------------------------------------------------------------


// --- KONSTANTEN und GLOBALE ZUSTÃ„NDE ---
const MODEL_VIEWER_TAG = 'model-viewer';
const MV_ID = 'modelViewer';
const ERR_ID = 'err';
const POSTER_ID = 'poster';
const AR_UI_ID = 'ar-ui';

let arAudio = null;
let cfg = null;
let isAudioMuted = false;
let isRecording = false;Â 
let recTimer = 0;
let recordingTimerId = null; // âœ… KORREKTUR: Globally accessible ID for the interval timer

// --- DOM-ELEMENTE ---
const modelViewer = document.getElementById(MV_ID);
const poster = document.getElementById(POSTER_ID);
const arUI = document.getElementById(AR_UI_ID);
const btnMute = document.getElementById('btn-mute');
const btnShutter = document.getElementById('btn-shutter');
const recInfo = document.getElementById('rec-info');
const errEl = document.getElementById(ERR_ID);
const startArButton = document.getElementById('startAr');
const btnGallery = document.getElementById('btn-gallery');


// --- HILFSFUNKTIONEN ---

function displayError(message) {
Â  Â  console.error('VIEWER ERROR:', message);
Â  Â  if (errEl) {
Â  Â  Â  Â  errEl.textContent = 'FEHLER: ' + message;
Â  Â  Â  Â  errEl.style.display = 'block';
Â  Â  }
}

function updateMuteButtonUI() {
Â  Â  btnMute.textContent = isAudioMuted ? 'ğŸ”‡' : 'ğŸ”Š';
}

/**
Â * Initialisiert das Audio-Handling basierend auf der Szene-Konfiguration.
Â */
function initAudio(audioCfg, sceneId, workerBase) {
Â  Â  if (!audioCfg || !audioCfg.url) {
Â  Â  Â  Â  if (btnMute) btnMute.style.display = 'none';
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // Pfad ist korrekt (Plural: /scenes/)
Â  Â  const audioUrl = `${workerBase}/scenes/${sceneId}/${audioCfg.url}`;
Â  Â Â 
Â  Â  arAudio = new Audio(audioUrl);
Â  Â  arAudio.loop = !!audioCfg.loop;
Â  Â  arAudio.volume = audioCfg.volume !== undefined ? audioCfg.volume : 0.8;

Â  Â  if (btnMute) {
Â  Â  Â  Â  // Audio-Button anzeigen, da Audio konfiguriert ist
Â  Â  Â  Â  btnMute.style.display = 'flex';
Â  Â  Â  Â  updateMuteButtonUI();

Â  Â  Â  Â  btnMute.onclick = () => {
Â  Â  Â  Â  Â  Â  isAudioMuted = !isAudioMuted;
Â  Â  Â  Â  Â  Â  arAudio.muted = isAudioMuted;
Â  Â  Â  Â  Â  Â  updateMuteButtonUI();
Â  Â  Â  Â  };
Â  Â  }
}

/**
Â * Steuert das Audio beim Start/Stopp von WebXR.
Â */
function toggleAudio(play) {
Â  Â  if (!arAudio) return;
Â  Â  if (play) {
Â  Â  Â  Â  if (!isAudioMuted) {
Â  Â  Â  Â  Â  Â  Â // Delay-Support hinzufÃ¼gen
Â  Â  Â  Â  Â  Â  const delay = cfg.audio?.delaySeconds || 0;
Â  Â  Â  Â  Â  Â  if (delay > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => arAudio.play().catch(e => console.warn('Audio play failed:', e)), delay * 1000);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  arAudio.play().catch(e => console.warn('Audio play failed:', e));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  } else {
Â  Â  Â  Â  arAudio.pause();
Â  Â  Â  Â  arAudio.currentTime = 0;
Â  Â  }
}

/**
Â * Wendet den Y-Offset zur Korrektur des Schwebens an.
Â */
function applyYOffset(yOffset) {
Â  Â  if (!modelViewer || yOffset === undefined) return;
Â  Â Â 
Â  Â  // Der Offset muss negativ sein, um das Modell im Viewport nach oben zu bewegen.
Â  Â  const offsetCSS = `${-yOffset}m`;
Â  Â  document.documentElement.style.setProperty('--model-vertical-offset', offsetCSS); // Setze es auf root
Â  Â Â 
Â  Â  console.log(`Angewandter Y-Offset (Anti-Schwebe-Fix): ${offsetCSS}`);
}

// --- SHUTTER / SCREENSHOT / VIDEO LOGIK ---

function formatTime(seconds) {
Â  Â  const min = Math.floor(seconds / 60).toString().padStart(2, '0');
Â  Â  const sec = (seconds % 60).toString().padStart(2, '0');
Â  Â  return `${min}:${sec}`;
}

/**
 * Startet den Videoaufnahme-Timer (Die eigentliche Videoaufnahme ist simuliert).
 */
function startRecordingTimer() {
Â  Â  recTimer = 0;
Â  Â  recInfo.textContent = formatTime(recTimer);
Â  Â  recInfo.style.display = 'flex';
Â  Â  btnShutter.classList.add('recording'); // FÃ¼ge Klasse zum Shutter hinzu

Â  Â  // Setzt die globale recordingTimerId
Â  Â  recordingTimerId = setInterval(() => {
Â  Â  Â  Â  recTimer++;
Â  Â  Â  Â  recInfo.textContent = formatTime(recTimer);
Â  Â  Â  Â  if (recTimer >= 60) {
Â  Â  Â  Â  Â  Â  stopRecording(); // âœ… KORREKTUR: Ruft stopRecording ohne ID auf
Â  Â  Â  Â  }
Â  Â  }, 1000);
}

/**
 * Stoppt die Videoaufnahme und den Timer.
 */
function stopRecording() { // âœ… KORREKTUR: Nimmt recordingTimerId nicht als Parameter an
Â  Â  if (recordingTimerId) {
Â  Â  Â  Â  clearInterval(recordingTimerId);
Â  Â  Â  Â  recordingTimerId = null; // Timer ID zurÃ¼cksetzen
Â  Â  }
Â  Â  isRecording = false;
Â  Â  btnShutter.classList.remove('recording');
Â  Â  recInfo.style.display = 'none';

Â  Â  console.log("Videoaufnahme gestoppt. Download wird initiiert (simuliert).");
}

function takeScreenshot() {
Â  Â  // Animation fÃ¼r den Button
Â  Â  btnShutter.classList.add('snap');
Â  Â  setTimeout(() => btnShutter.classList.remove('snap'), 300);

Â  Â  // Screenshot als Blob herunterladen
Â  Â  modelViewer.toBlob({ mimeType: 'image/png' })
Â  Â  Â  Â  .then(blob => {
Â  Â  Â  Â  Â  Â  const url = URL.createObjectURL(blob);
Â  Â  Â  Â  Â  Â  const a = document.createElement('a');
Â  Â  Â  Â  Â  Â  a.href = url;
Â  Â  Â  Â  Â  Â  a.download = 'ARea_Screenshot.png';
Â  Â  Â  Â  Â  Â  document.body.appendChild(a);
Â  Â  Â  Â  Â  Â  a.click();
Â  Â  Â  Â  Â  Â  document.body.removeChild(a);
Â  Â  Â  Â  Â  Â  URL.revokeObjectURL(url);
Â  Â  Â  Â  })
Â  Â  Â  Â  .catch(e => console.error('Screenshot failed:', e));
}


// --- INITIALISIERUNG und EVENTS ---

/**
Â * Hauptladefunktion.
Â */
async function loadScene() {
Â  Â  try {
Â  Â  Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  Â  Â  const sceneId = urlParams.get('scene');
Â  Â  Â  Â  const workerBase = urlParams.get('base');

Â  Â  Â  Â  if (!sceneId || !workerBase) {
Â  Â  Â  Â  Â  Â  throw new Error('Fehlende URL-Parameter (scene/base).');
Â  Â  Â  Â  }

Â  Â  Â  Â  // Pfad ist korrekt (Plural: /scenes/)
Â  Â  Â  Â  const sceneConfigUrl = `${workerBase}/scenes/${sceneId}/scene.json`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 1. Konfiguration laden (fetchWithTimeout ist jetzt robust)
Â  Â  Â  Â  const response = await fetchWithTimeout(sceneConfigUrl, { timeoutMs: 15000 });
Â  Â  Â  Â  if (!response.ok) throw new Error(`Laden von scene.json fehlgeschlagen: ${response.status}`);
Â  Â  Â  Â Â 
Â  Â  Â  Â  cfg = await response.json();

Â  Â  Â  Â  // 2. Model-Viewer konfigurieren
Â  Â  Â  Â  if (!cfg.model || !cfg.model.url) {
Â  Â  Â  Â  Â  Â  throw new Error('Kein 3D-Modell in der Konfiguration gefunden.');
Â  Â  Â  Â  }

Â  Â  Â  Â  // Pfad ist korrekt (Plural: /scenes/)
Â  Â  Â  Â  const modelUrl = `${workerBase}/scenes/${sceneId}/${cfg.model.url}`;Â 
Â  Â  Â  Â  modelViewer.setAttribute('src', modelUrl);
Â  Â  Â  Â  modelViewer.setAttribute('alt', cfg.meta?.title || '3D-Modell');
Â  Â  Â  Â  modelViewer.setAttribute('shadow-intensity', '1');
Â  Â  Â  Â  modelViewer.setAttribute('camera-controls', '');
Â  Â  Â  Â  modelViewer.setAttribute('auto-rotate', '');Â 
Â  Â  Â  Â  modelViewer.setAttribute('ar', '');
Â  Â  Â  Â  modelViewer.setAttribute('ar-modes', 'webxr scene-viewer quick-look');
Â  Â  Â  Â  modelViewer.setAttribute('interaction-prompt', 'none');Â 
Â  Â  Â  Â  modelViewer.setAttribute('auto-rotate-delay', '1000');
Â  Â  Â  Â  modelViewer.setAttribute('disable-tap', '');Â 

Â  Â  Â  Â  // 3. Audio initialisieren
Â  Â  Â  Â  initAudio(cfg.audio, sceneId, workerBase);

Â  Â  Â  Â  // 4. Anti-Schwebe-Fix anwenden
Â  Â  Â  Â  if (cfg.model.yOffset !== undefined) {
Â  Â  Â  Â  Â  Â  applyYOffset(cfg.model.yOffset);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 5. Poster-Text aktualisieren
Â  Â  Â  Â  const posterTitle = document.getElementById('posterTitle');
Â  Â  Â  Â  const posterText = document.getElementById('posterText');
Â  Â  Â  Â  if (posterTitle) posterTitle.textContent = cfg.meta?.title || 'Augmented Reality Erlebnis';
Â  Â  Â  Â  if (posterText) posterText.textContent = 'Tippe auf START AR, um das Modell in deiner Umgebung zu sehen.';Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 6. Events hinzufÃ¼gen
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Poster ausblenden, AR-UI einblenden, Audio starten, sobald AR/XR startet
Â  Â  Â  Â  modelViewer.addEventListener('ar-status', (event) => {
Â  Â  Â  Â  Â  Â  if (event.detail.status === 'session-started') {
Â  Â  Â  Â  Â  Â  Â  Â  poster.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  arUI.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  toggleAudio(true);
Â  Â  Â  Â  Â  Â  } else if (event.detail.status === 'session-ended') {
Â  Â  Â  Â  Â  Â  Â  Â  arUI.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  toggleAudio(false);
Â  Â  Â  Â  Â  Â  Â  Â  poster.style.display = 'flex';
Â  Â  Â  Â  Â  Â  Â  Â  if (isRecording) stopRecording(); // âœ… KORREKTUR: Stoppt die Aufnahme, wenn AR beendet wird
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Event-Listener fÃ¼r den Shutter-Button
Â  Â  Â  Â  btnShutter.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  if (isRecording) {
Â  Â  Â  Â  Â  Â  Â  Â  stopRecording(); // âœ… KORREKTUR: Ruft stopRecording ohne ID auf
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  takeScreenshot();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  btnShutter.addEventListener('contextmenu', (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  if (isRecording) return; // Nicht starten, wenn bereits aufnimmt
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Check, ob AR-Session aktiv ist
Â  Â  Â  Â  Â  Â  if (modelViewer.hasARSession) {
Â  Â  Â  Â  Â  Â  Â  Â  isRecording = true;
Â  Â  Â  Â  Â  Â  Â  Â  btnShutter.classList.add('recording');
Â  Â  Â  Â  Â  Â  Â  Â  startRecordingTimer(); // Startet den Timer und setzt die globale ID
Â  Â  Â  Â  Â  Â  Â  Â  console.log("Videoaufnahme gestartet (simuliert).");
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  console.warn("Videoaufnahme nur in aktiver AR-Sitzung mÃ¶glich.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // Klick-Handling (URL-Weiterleitung)
Â  Â  Â  Â  modelViewer.addEventListener('click', (event) => {
Â  Â  Â  Â  Â  Â  if (!cfg.clickableNodes || cfg.clickableNodes.length === 0) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ÃœberprÃ¼fe, ob auf das Modell oder den Canvas geklickt wurde
Â  Â  Â  Â  Â  Â  // Anmerkung: Hotspots mÃ¼ssen in model-viewer Ã¼ber eigene HTML-Elemente gelÃ¶st werden.
Â  Â  Â  Â  Â  Â  if (event.detail.target === modelViewer || event.detail.target.tagName === 'CANVAS') {
Â  Â  Â  Â  Â  Â  Â  Â  const clickable = cfg.clickableNodes[0];Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (clickable && clickable.url) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // PrÃ¼fen, ob eine AR-Session aktiv ist
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isARActive = modelViewer.matches(':--ar-session');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isARActive) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // In AR-Session: Stoppen und dann Ã¶ffnen
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â modelViewer.stopAR();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â setTimeout(() => window.open(clickable.url, '_blank'), 500);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Im 3D-Modus sofort Ã¶ffnen
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.open(clickable.url, '_blank');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  } catch (error) {
Â  Â  Â  Â  displayError(error.message);
Â  Â  }
}

// Initialer Start des Ladevorgangs
document.addEventListener('DOMContentLoaded', () => {
Â  Â  if (!modelViewer) {
Â  Â  Â  Â  displayError('model-viewer Element fehlt.');
Â  Â  Â  Â  return;
Â  Â  }
Â  Â Â 
Â  Â  // Setzt das initial benÃ¶tigte CSS fÃ¼r den Y-Offset (wird auf HTML-Root gesetzt)
Â  Â  document.documentElement.style.setProperty('--model-vertical-offset', '0');Â 
Â  Â Â 
Â  Â  // Sicherstellen, dass die Poster-ID's gesetzt sind (falls nicht in der Markup vorhanden)
Â  Â  if(!document.getElementById('posterTitle') && document.querySelector('#poster-inner h1')) {
Â  Â  Â  Â  document.querySelector('#poster-inner h1').id = 'posterTitle';
Â  Â  }
Â  Â  if(!document.getElementById('posterText') && document.querySelector('#poster-inner p')) {
Â  Â  Â  Â  document.querySelector('#poster-inner p').id = 'posterText';
Â  Â  }

Â  Â  // START AR Button Handler
Â  Â  startArButton.onclick = () => {
Â  Â  Â  Â  modelViewer.activateAR();
Â  Â  Â  Â  startArButton.disabled = true;Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // FÃ¼ge einen Listener hinzu, um den Button bei Fehler freizugeben
Â  Â  Â  Â  modelViewer.addEventListener('ar-status', (event) => {
Â  Â  Â  Â  Â  Â  if (event.detail.status === 'failed' || event.detail.status === 'not-presenting') {
Â  Â  Â  Â  Â  Â  Â  Â  startArButton.disabled = false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }, { once: true }); // Nur einmal auslÃ¶sen
Â  Â  }
Â  Â Â 
Â  Â  // Startet das Laden
Â  Â  loadScene();
});
Â  </script>

</body>
</html>
